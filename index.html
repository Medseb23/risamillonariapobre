<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Detector de Risa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      background-color: #f0f0f0;
    }
    #resultado {
      font-size: 2em;
      margin: 20px 0;
    }
    #carrusel {
      position: relative;
      width: 100%;
      max-width: 360px;
      margin: 0 auto;
      height: 640px; /* 9:16 aspect ratio */
      overflow: hidden;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    #carrusel img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0;
      transition: opacity 1s ease-in-out;
    }
    #carrusel img.active {
      opacity: 1;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Detector de Risa</h1>
  <button id="iniciar">Iniciar</button>
  <div id="resultado">Esperando...</div>
  <div id="carrusel"></div>

  <script>
    const boton = document.getElementById('iniciar');
    const resultado = document.getElementById('resultado');
    const carrusel = document.getElementById('carrusel');

    const imagenesMillonario = [
      'millonario1.jpg',
      'millonario2.jpg',
      'millonario3.jpg'
    ];

    const imagenesPobre = [
      'pobre1.jpg',
      'pobre2.jpg',
      'pobre3.jpg'
    ];

    boton.onclick = async () => {
      boton.disabled = true;
      resultado.textContent = 'Escuchando...';
      carrusel.innerHTML = '';

      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const source = audioContext.createMediaStreamSource(stream);
      const analyser = audioContext.createAnalyser();
      analyser.fftSize = 2048;
      source.connect(analyser);
      const buffer = new Float32Array(analyser.fftSize);

      function autoCorrelacion(buf, sampleRate) {
        let SIZE = buf.length;
        let rms = 0;
        for (let i = 0; i < SIZE; i++) {
          let val = buf[i];
          rms += val * val;
        }
        rms = Math.sqrt(rms / SIZE);
        if (rms < 0.01) return -1;

        let r1 = 0, r2 = SIZE - 1, thres = 0.2;
        for (let i = 0; i < SIZE / 2; i++) {
          if (Math.abs(buf[i]) < thres) { r1 = i; break; }
        }
        for (let i = 1; i < SIZE / 2; i++) {
          if (Math.abs(buf[SIZE - i]) < thres) { r2 = SIZE - i; break; }
        }

        buf = buf.slice(r1, r2);
        SIZE = buf.length;

        let c = new Array(SIZE).fill(0);
        for (let i = 0; i < SIZE; i++) {
          for (let j = 0; j < SIZE - i; j++) {
            c[i] = c[i] + buf[j] * buf[j + i];
          }
        }

        let d = 0; while (c[d] > c[d + 1]) d++;
        let maxval = -1, maxpos = -1;
        for (let i = d; i < SIZE; i++) {
          if (c[i] > maxval) {
            maxval = c[i];
            maxpos = i;
          }
        }
        let T0 = maxpos;

        return sampleRate / T0;
      }

      let frecuencias = [];
      const duracion = 5000; // 5 segundos
      const intervalo = 100; // cada 100 ms

      const intervaloID = setInterval(() => {
        analyser.getFloatTimeDomainData(buffer);
        let pitch = autoCorrelacion(buffer, audioContext.sampleRate);
        if (pitch !== -1) {
          frecuencias.push(pitch);
        }
      }, intervalo);

      setTimeout(() => {
        clearInterval(intervaloID);
        if (frecuencias.length === 0) {
          resultado.textContent = 'ðŸ˜¶ Sin risa detectada';
          boton.disabled = false;
          return;
        }
        const suma = frecuencias.reduce((a, b) => a + b, 0);
        const promedio = suma / frecuencias.length;
        let imagenes = [];
        if (promedio < 150) {
          resultado.textContent = 'ðŸ’° Millonario';
          imagenes = imagenesMillonario;
        } else {
          resultado.textContent = 'ðŸ’¸ Pobre';
          imagenes = imagenesPobre;
        }
        mostrarCarrusel(imagenes);
        boton.disabled = false;
      }, duracion);
    };

    function mostrarCarrusel(imagenes) {
      carrusel.innerHTML = '';
      imagenes.forEach((src, index) => {
        const img = document.createElement('img');
        img.src = src;
        if (index === 0) img.classList.add('active');
        carrusel.appendChild(img);
      });

      let current = 0;
      const total = imagenes.length;
      setInterval(() => {
        const imgs = carrusel.querySelectorAll('img');
        imgs[current].classList.remove('active');
        current = (current + 1) % total;
        imgs[current].
::contentReference[oaicite:4]{index=4}
 
